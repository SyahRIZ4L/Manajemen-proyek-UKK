<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test JavaScript Syntax</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Test JavaScript Pop-up</h2>
        <div id="result" class="alert alert-info">
            Status: Loading...
        </div>

        <button class="btn btn-success start-work-btn"
                data-card-id="123"
                data-card-title="Test Card">
            <i class="bi bi-play"></i> Start Card
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test JavaScript sederhana tanpa template literals
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, setting up event listeners...');

            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'Status: JavaScript loaded successfully!';
            resultDiv.className = 'alert alert-success';

            initializeCardButtons();
        });

        function initializeCardButtons() {
            console.log('Initializing card buttons...');

            const startWorkButtons = document.querySelectorAll('.start-work-btn');
            console.log('Found ' + startWorkButtons.length + ' start work buttons');

            startWorkButtons.forEach(function(button) {
                const cardId = button.getAttribute('data-card-id');
                const cardTitle = button.getAttribute('data-card-title');
                console.log('Setting up start button for card ' + cardId + ': ' + cardTitle);

                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('Start button clicked for card ' + cardId);

                    if (button.disabled) {
                        console.log('Button already processing, ignoring click');
                        return;
                    }

                    const currentCardId = this.getAttribute('data-card-id');
                    const currentCardTitle = this.getAttribute('data-card-title');

                    console.log('Showing confirmation modal for start card...');
                    showConfirmationModal(
                        'Mulai Mengerjakan Card',
                        'Apakah Anda yakin ingin mulai mengerjakan "' + currentCardTitle + '"? Status akan berubah menjadi In Progress.',
                        'Mulai Kerjakan',
                        'btn-success',
                        function() {
                            console.log('Confirmed: Starting card ' + currentCardId);
                            alert('Card ' + currentCardId + ' would be started!');
                        }
                    );
                });
            });

            console.log('All card buttons initialized successfully');
        }

        function showConfirmationModal(title, message, confirmText, confirmClass, onConfirm) {
            console.log('showConfirmationModal called with title: ' + title);

            const modalId = 'confirmActionModal';
            const uniqueId = modalId + '_' + Date.now();

            // Remove any existing modals
            const existingModals = document.querySelectorAll('[id^="confirmActionModal"]');
            existingModals.forEach(function(modal) {
                const bootstrapModal = bootstrap.Modal.getInstance(modal);
                if (bootstrapModal) {
                    bootstrapModal.dispose();
                }
                modal.remove();
            });

            // Create modal HTML
            const modalHTML = '<div class="modal fade" id="' + uniqueId + '" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">' +
                '<div class="modal-dialog modal-dialog-centered">' +
                    '<div class="modal-content shadow-lg">' +
                        '<div class="modal-header border-bottom-0 bg-light">' +
                            '<h5 class="modal-title fw-bold">' +
                                '<i class="bi bi-question-circle-fill me-2 text-primary"></i>' + title +
                            '</h5>' +
                            '<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>' +
                        '</div>' +
                        '<div class="modal-body py-4">' +
                            '<div class="d-flex align-items-start">' +
                                '<div class="flex-shrink-0 me-3">' +
                                    '<i class="bi bi-info-circle-fill text-info fs-3"></i>' +
                                '</div>' +
                                '<div class="flex-grow-1">' +
                                    '<p class="mb-0 fs-6">' + message + '</p>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="modal-footer border-top-0">' +
                            '<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">' +
                                '<i class="bi bi-x me-1"></i>Batal' +
                            '</button>' +
                            '<button type="button" class="btn ' + confirmClass + '" id="confirmBtn_' + uniqueId + '">' +
                                '<i class="bi bi-check me-1"></i>' + confirmText +
                            '</button>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';

            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            const modalElement = document.getElementById(uniqueId);
            const confirmButton = document.getElementById('confirmBtn_' + uniqueId);

            console.log('Modal created, showing... ' + uniqueId);

            // Show modal
            const modal = new bootstrap.Modal(modalElement, {
                backdrop: 'static',
                keyboard: false
            });

            modal.show();

            // Handle confirm button click
            confirmButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Confirm button clicked');

                // Disable button to prevent double-clicks
                confirmButton.disabled = true;
                confirmButton.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Processing...';

                // Hide modal
                modal.hide();

                // Execute callback after modal is hidden
                setTimeout(function() {
                    if (onConfirm && typeof onConfirm === 'function') {
                        console.log('Executing confirm callback');
                        onConfirm();
                    }
                }, 300);
            });

            // Clean up modal after hide
            modalElement.addEventListener('hidden.bs.modal', function() {
                console.log('Modal hidden, cleaning up');
                modal.dispose();
                this.remove();
            });

            // Focus on confirm button after modal is shown
            modalElement.addEventListener('shown.bs.modal', function() {
                confirmButton.focus();
            });
        }
    </script>
</body>
</html>
